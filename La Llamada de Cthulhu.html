<!DOCTYPE html>
<html lang="es">
<head>
    <title>Gastos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <link rel="stylesheet" href="La Llamada de Cthulhu.css">

</head>

<body>
<div class="section-header" >
    <div class="table-u">
        <h4 class="title" data-i18n="investigatorinfo-u"></h4>
        <div class="table-userinfo">
            <div>
                <img name="attr_character_token">
            </div>
            <div>
                <div class="character">
                    <span data-i18n="investigator-name-u"></span>
                    <input type="text" name="attr_character_name"/>
                </div>        
                <div class="character">
                    <span data-i18n="birthplace-u"></span>
                    <input type="text" name="attr_Birthplace" />
                </div>
                <div class="character">
                    <span data-i18n="occupation-u"></span>
                    <input type="text" name="attr_occupation" />
                </div>
                <div class="character">
                    <div class="character">
                        <span data-i18n="sex-u"></span>
                        <input type="text" name="attr_gender" />
                    </div>
                    <div class="character">
                        <span data-i18n="age-u"></span>
                        <input type="text" name="attr_age" />
                    </div>            
                </div>
                <div class="character">
                    <span data-i18n="degrees-u"></span>
                    <input type="text" name="attr_degress" />
                </div>
            </div>
        </div>
    </div>
    <div class="table-u" >
        <h4 class="title" data-i18n="characteristics-u"></h4>
        <div class="table-charac">
            <div class="primary" >
                <div class="attribute">
                    <span data-i18n="FUE"></span>
                    <div class="trow">
                        <input type="number" class="readonly attrs" value="3" name="attr_FUE" />
                        <div class="buttons" >
                            <button type="action" class="attr up" name="FUE"></button>
                            <button type="action" class="attr down" name="FUE"></button>
                        </div>
                    </div>
                </div>
                <div class="attribute">
                    <span data-i18n="DES"></span>
                    <div class="trow">
                        <input type="number" class="readonly attrs" value="3" name="attr_DES" />
                        <div class="buttons" >
                            <button type="action" class="attr up" name="DES"></button>
                            <button type="action" class="attr down" name="DES"></button>
                        </div>
                    </div>
                </div>
                <div class="attribute">
                    <span data-i18n="INT"></span>
                    <div class="trow">
                        <input type="number" class="readonly attrs" value="8" name="attr_INT" />
                        <div class="buttons" >
                            <button type="action" class="attr up" name="INT"></button>
                            <button type="action" class="attr down" name="INT"></button>
                        </div>
                    </div>
                </div>
                <div class="attribute">
                    <span data-i18n="idea"></span>
                    <div>
                        <input type="number" class="readonly" name="attr_idea" />
                    </div>
                    <button type="action" name="act_idea" class="roll secondary" ></button>
                </div>
                <div class="attribute">
                    <span data-i18n="CON"></span>
                    <div class="trow">
                        <input type="number" class="readonly attrs" value="3" name="attr_CON" />
                        <div class="buttons" >
                            <button type="action" class="attr up" name="CON"></button>
                            <button type="action" class="attr down" name="CON"></button>
                        </div>
                    </div>
                </div>
                <div class="attribute">
                    <span data-i18n="APA"></span>
                    <div class="trow">
                        <input type="number" class="readonly attrs" value="3" name="attr_APA" />
                        <div class="buttons" >
                            <button type="action" class="attr up" name="APA"></button>
                            <button type="action" class="attr down" name="APA"></button>
                        </div>
                    </div>
                </div>
                <div class="attribute">
                    <span data-i18n="POD"></span>
                    <div class="trow">
                        <input type="number" class="readonly attrs" value="3" name="attr_POD" />
                        <div class="buttons" >
                            <button type="action" class="attr up" name="POD"></button>
                            <button type="action" class="attr down" name="POD"></button>
                        </div>
                    </div>
                </div>
                <div class="attribute">
                    <span data-i18n="luck"></span>
                    <div>
                        <input type="number" class="readonly" name="attr_luck" />
                    </div>
                    <button type="action" name="act_luck" class="roll secondary" ></button>
                </div>
                <div class="attribute">
                    <span data-i18n="TAM"></span>
                    <div class="trow">
                        <input type="number" class="readonly attrs" value="8" name="attr_TAM" />
                        <div class="buttons" >
                            <button type="action" class="attr up" name="TAM"></button>
                            <button type="action" class="attr down" name="TAM"></button>
                        </div>
                    </div>
                </div>
                <div class="attribute">
                    <span data-i18n="COR"></span>
                    <div>
                        <input type="number" class="readonly" name="attr_COR" />
                    </div>
                </div>
                <div class="attribute">
                    <span data-i18n="EDU"></span>
                    <div class="trow">
                        <input type="number" class="readonly attrs" value="6" name="attr_EDU"  />
                        <div class="buttons" >
                            <button type="action" class="attr up" name="EDU"></button>
                            <button type="action" class="attr down" name="EDU"></button>
                        </div>
                    </div>
                </div>
                <div class="attribute">
                    <span data-i18n="know"></span>
                    <div>
                        <input type="number" class="readonly" name="attr_know" />
                    </div>
                    <button type="action" name="act_know" class="roll secondary" ></button>
                </div>
                <div class="attribute">
                    <span data-i18n="stable-sanity-u"></span>
                    <div>
                        <input type="number" name="attr_Max-Sanity" class="readonly" />
                    </div>
                </div>
            </div>
            <div class="secondary">
                <div class="attribute">
                    <span data-i18n="hp-points-u"></span>
                    <div class="trow">
                        <input type="number" class="readonly" name="attr_HP" />
                        <div class="buttons">
                            <button type="action" class="attr up" name="HP"></button>
                            <button type="action" class="attr down" name="HP"></button>
                        </div>
                        <span class="attribute_divider">/</span>
                        <input type="number" name="attr_stableHP" class="readonly" />
                    </div>
                    
                </div>
                <div class="attribute">
                    <span data-i18n="mp-u"></span>
                    <div class="trow">
                        <input type="number" class="readonly" name="attr_MP" />
                        <div class="buttons">
                            <button type="action" class="attr up" name="MP"></button>
                            <button type="action" class="attr down" name="MP"></button>
                        </div>
                        <span class="attribute_divider">/</span>
                        <input type="number" name="attr_stableMP" class="readonly" />
                    </div>
                </div>
                <div class="attribute">
                    <span data-i18n="sanity-points-u"></span>
                    <div class="trow">
                        <input type="number" class="readonly" name="attr_Sanity" />
                        <div class="buttons">
                            <button type="action" class="attr up" name="Sanity"></button>
                            <button type="action" class="attr down" name="Sanity"></button>
                        </div>
                        <span class="attribute_divider">/</span>
                        <input type="number" name="attr_Max-Sanity" class="readonly" />
                    </div>
                    <button type="action" name="act_Sanity" class="roll secondary" ></button>
                </div>
            </div>
        </div>
    </div>
</div>
<input type="hidden" class="tabstoggle" name="attr_sheetTab" value="skills"  />
<div class="navigation">
    <label class="navigation_item" data-i18n-title="enable skills tab">
        <input name="attr_sheetTab" class="navbar" type="radio" value="skills" />
        <div class="navigation__label">
            <span data-i18n="skills-u">Habilidades</span>
        </div>
    </label>
    <label class="navigation_item" data-i18n-title="enable combat tab">
        <input name="attr_sheetTab" class="navbar" type="radio" value="combat" />
        <div class="navigation__label">
            <span>Combate</span>
        </div>
    </label>
    <label class="navigation_item" data-i18n-title="enable items tab">
        <input name="attr_sheetTab" class="navbar" type="radio" value="items" />
        <div class="navigation__label">
            <span>Equipo y armas</span>
        </div>
    </label>
</div>
<div id="skills" class="tabcontent">
    <div data-i18n-list="skills-list" class="skills" >
        <div class="col">
            <div class="trow" value="@{success-anthropology}" data-i18n-list-item="anthropology">
                <input type="checkbox" name="attr_success-anthropology" />
                <span class="td">
                    <span data-i18n="anthropology" ></span> (01%)
                </span>
                <input type="number" name="attr_anthropology" value="1" />
                <button type="action" class="roll skill" name="act_anthropology" ></button>
            </div>
            <div class="trow" data-i18n-list-item="archaeology">
                <input type="checkbox" name="attr_success-archaeology"/>
                <span class="td">
                    <span data-i18n="archaeology"></span> (01%)
                </span>
                <input type="number" name="attr_archaeology" value="1" />
                <button type="action" class="roll skill" name="act_archaeology" ></button>
            </div>
            <div style="margin-left: 5%;">
                <span></span>
                <span>
                    <span data-i18n="art"></span> (05%)
                </span>
                <span></span>
                <span></span>
            </div>
            <fieldset class="repeating_art">
                <div class="trow">
                    <input type="checkbox" name="attr_success" />
                    <div style="width: 100%;">
                        <input style="width: 80%;" type="text" name="attr_skillname"></input>
                    </div>
                    <input type="number" name="attr_score" value="5" />
                    <button type="action" class="roll skill" name="act_score" ></button>
                </div>
            </fieldset>
            <div style="margin-left: 5%;">
                <span></span>
                <span>
                    <span data-i18n="martial-arts"></span> (01%)
                </span>
                <span></span>
                <span></span>
            </div>
            <fieldset class="repeating_martial">
                <div class="trow">
                    <input class="checkbox" type="checkbox" name="attr_success" />
                    <div style="width: 100%;">
                        <input style="width: 80%;" type="text" name="attr_martial-name"></input>
                    </div>
                    <input type="number" name="attr_martial" value="1" />
                </div>
            </fieldset>
            <div class="trow" data-i18n-list-item="astronomy">
                <input type="checkbox" name="attr_success-astronomy" />
                <span class="td">
                    <span data-i18n="astronomy"></span> (01%)
                </span>
                <input type="number" name="attr_astronomy" value="1" min="1" />
                <button type="action" class="roll skill" name="act_astronomy" ></button>
            </div>
            <div class="trow" data-i18n-list-item="biology">
                <input type="checkbox" name="attr_success-biology" />
                <span class="td">
                    <span data-i18n="biology"></span> (01%)
                </span>
                <input type="number" name="attr_biology" value="1" min="1" />
                <button type="action" class="roll skill" name="act_biology" ></button>
            </div>
            <div class="trow" data-i18n-list-item="library-use">
                <input type="checkbox" name="attr_success-library-use" />
                <span class="td">
                    <span data-i18n="library-use"></span> (25%)
                </span>
                <input type="number" name="attr_library-use" value="25" min="25" />
                <button type="action" class="roll skill" name="act_library-use" ></button>
            </div>
            <div class="trow" data-i18n-list-item="locksmith">
                <input type="checkbox" name="attr_success-locksmith" />
                <span class="td">
                    <span data-i18n="locksmith"></span> (01%)
                </span>
                <input type="number" name="attr_locksmith" value="1" min="1" />
                <button type="action" class="roll skill" name="act_locksmith" ></button>
            </div>
            <div class="trow" data-i18n-list-item="fast-talk">
                <input type="checkbox" name="attr_success-fast-talk" />
                <span class="td">
                    <span data-i18n="fast-talk"></span> (01%)
                </span>
                <input type="number" name="attr_fast-talk" value="1" min="1" />
                <button type="action" class="roll skill" name="act_fast-talk" ></button>
            </div>
            <div class="trow" data-i18n-list-item="occult">
                <input type="checkbox" name="attr_success-occult" />
                <span class="td">
                    <span data-i18n="occult"></span> (05%)
                </span>
                <input type="number" name="attr_occult" value="5" min="5" />
                <button type="action" class="roll skill" name="act_occult" ></button>
            </div>
            <div class="trow" data-i18n-list-item="drive">
                <input type="checkbox" name="attr_success-drive" />
                <span class="td">
                    <span data-i18n="drive"></span> (20%)
                </span>
                <input type="number" name="attr_drive" value="20" min="20" />
                <button type="action" class="roll skill" name="act_drive" ></button>
            </div>
            <div class="trow" data-i18n-list-item="hvy-machine">
                <input type="checkbox" name="attr_success-hvy-machine" />
                <span class="td">
                    <span data-i18n="hvy-machine"></span> (01%)
                </span>
                <input type="number" name="attr_hvy-machine" value="1" min="1" />
                <button type="action" class="roll skill" name="act_hvy-machine" ></button>
            </div>
            <div class="trow" data-i18n-list-item="accounting">
                <input type="checkbox" name="attr_success-accounting" />
                <span class="td">
                    <span data-i18n="accounting"></span> (10%)
                </span>
                <input type="number" name="attr_accounting" value="10" min="10" />
                <button type="action" class="roll skill" name="act_accounting" ></button>
            </div>
            <div class="trow" data-i18n-list-item="credit-rating">
                <input type="checkbox" name="attr_success-credit-rating" />
                <span class="td">
                    <span data-i18n="credit-rating"></span> (15%)
                </span>
                <input type="number" name="attr_credit-rating" value="15" min="15" />
                <button type="action" class="roll skill" name="act_credit-rating" ></button>
            </div>
            <div class="trow" data-i18n-list-item="law">
                <input type="checkbox" name="attr_success-law" />
                <span class="td">
                    <span data-i18n="law"></span> (05%)
                </span>
                <input type="number" name="attr_law" value="5" min="5" />
                <button type="action" class="roll skill" name="act_law" ></button>
            </div>
            <div class="trow" data-i18n-list-item="spot-hidden">
                <input type="checkbox" name="attr_success-spot-hidden" />
                <span class="td">
                    <span data-i18n="spot-hidden"></span> (25%)
                </span>
                <input type="number" name="attr_spot-hidden" value="25" min="25" />
                <button type="action" class="roll skill" name="act_spot-hidden" ></button>
            </div>
            <div class="trow" data-i18n-list-item="sneak">
                <input type="checkbox" name="attr_success-sneak" />
                <span class="td">
                    <span data-i18n="sneak"></span> (10%)
                </span>
                <input type="number" name="attr_sneak" value="10" min="10" />
                <button type="action" class="roll skill" name="act_sneak" ></button>
            </div>
            <div class="trow" data-i18n-list-item="disguise">
                <input type="checkbox" name="attr_success-disguise" />
                <span class="td">
                    <span data-i18n="disguise"></span> (01%)
                </span>
                <input type="number" name="attr_disguise" value="1" min="1" />
                <button type="action" class="roll skill" name="act_disguise" ></button>
            </div>
            <div class="trow" data-i18n-list-item="electrical-repair">
                <input type="checkbox" name="attr_success-electrical-repair" />
                <span class="td">
                    <span data-i18n="electrical-repair"></span> (10%)
                </span>
                <input type="number" name="attr_electrical-repair" value="10" min="10" />
                <button type="action" class="roll skill" name="act_electrical-repair" ></button>
            </div>
            <div class="trow" data-i18n-list-item="ride">
                <input type="checkbox" name="attr_success-ride" />
                <span class="td">
                    <span data-i18n="ride"></span> (5%)
                </span>
                <input type="number" name="attr_ride" value="5" min="5" />
                <button type="action" class="roll skill" name="act_ride" ></button>
            </div>
            <div class="trow" data-i18n-list-item="listen">
                <input type="checkbox" name="attr_success-listen" />
                <span class="td">
                    <span data-i18n="listen"></span> (25%)
                </span>
                <input type="number" name="attr_listen" value="25" min="25" />
                <button type="action" class="roll skill" name="act_listen" ></button>
            </div>
            <div class="trow" data-i18n-list-item="dodge">
                <input type="checkbox" name="attr_success-dodge" />
                <span class="td">
                    <span data-i18n="dodge"></span> (DES x 2%)
                </span>
                <input type="number" name="attr_dodge" />
                <button type="action" class="roll skill" name="act_dodge" ></button>
            </div>
            <div class="trow" data-i18n-list-item="pharmacy">
                <input type="checkbox" name="attr_success-pharmacy" />
                <span class="td">
                    <span data-i18n="pharmacy"></span> (01%)
                </span>
                <input type="number" name="attr_pharmacy" value="1" min="1" />
                <button type="action" class="roll skill" name="act_pharmacy" ></button>
            </div>
            <div class="trow" data-i18n-list-item="physics">
                <input type="checkbox" name="attr_success-physics" />
                <span class="td">
                    <span data-i18n="physics"></span> (01%)
                </span>
                <input type="number" name="attr_physics" value="1" min="1" />
                <button type="action" class="roll skill" name="act_physics" ></button>
            </div>
            <div class="trow" data-i18n-list-item="photography">
                <input type="checkbox" name="attr_success-photography" />
                <span class="td">
                    <span data-i18n="photography"></span> (10%)
                </span>
                <input type="number" name="attr_photography" value="10" min="10" />
                <button type="action" class="roll skill" name="act_photography" ></button>
            </div>
        </div>
        <div class="col">
            <div class="trow" data-i18n-list-item="geology">
                <input type="checkbox" name="attr_success-geology" />
                <span class="td">
                    <span data-i18n="geology"></span> (01%)
                </span>
                <input type="number"name="attr_geology" value="1" min="1" />
                <button type="action" class="roll skill" name="act_geology" ></button>
            </div>
            <div class="trow" data-i18n-list-item="history">
                <input type="checkbox" name="attr_success-history" />
                <span class="td">
                    <span data-i18n="history"></span> (20%)
                </span>
                <input type="number" name="attr_history" value="20" min="20" />
                <button type="action" class="roll skill" name="act_history" ></button>
            </div>
            <div class="trow" data-i18n-list-item="natural-history">
                <input type="checkbox" name="attr_success-natural-history" />
                <span class="td">
                    <span data-i18n="natural-history"></span> (10%)
                </span>
                <input type="number" name="attr_natural-history" value="10" min="10" />
                <button type="action" class="roll skill" name="act_natural-history" ></button>
            </div>
            <div class="trow" data-i18n-list-item="throw">
                <input type="checkbox" name="attr_success-throw" />
                <span class="td">
                    <span data-i18n="throw"></span> (25%)
                </span>
                <input type="number" name="attr_throw" value="25" min="25" />
                <button type="action" class="roll skill" name="act_throw" ></button>
            </div>
            <div style="margin: 2% 5%;">
                <span></span>
                <span>
                    <span data-i18n="own-language"></span> (EDUx5%)
                </span>
                <span></span>
                <span></span>
            </div>
            <div class="trow" data-i18n-list-item="own-language">
                <input type="checkbox" name="attr_success-own-language" />
                <div>
                    <input type="text" name="attr_own-language-name" />
                </div>                
                <input type="number" name="attr_own-language" />
                <button type="action" class="roll skill" name="act_own-language" ></button>
            </div>
            <div class="trow" data-i18n-list-item="mechanical-repair">
                <input type="checkbox" name="attr_success-mechanical-repair" />
                <span class="td">
                    <span data-i18n="mechanical-repair"></span> (20%)
                </span>
                <input type="number" name="attr_mechanical-repair" min="20" value="20" />
                <button type="action" class="roll skill" name="act_mechanical-repair" ></button>
            </div>
            <div class="trow" data-i18n-list-item="medicine">
                <input type="checkbox" name="attr_success-medicine" />
                <span class="td">
                    <span data-i18n="medicine"></span> (05%)
                </span>
                <input type="number" name="attr_medicine" min="5" value="5" />
                <button type="action" class="roll skill" name="act_medicine" ></button>
            </div>
            <div class="trow" data-i18n-list-item="cthulhumythos">
                <input type="checkbox" name="attr_success-cthulhumythos" />
                <span class="td">
                    <span data-i18n="cthulhumythos"></span> (00%)
                </span>
                <input type="number" name="attr_cthulhumythos" min="0" value="0" />
                <button type="action" class="roll skill" name="act_cthulhumythos" ></button>
            </div>
            <div class="trow" data-i18n-list-item="swim">
                <input type="checkbox" name="attr_success-swim" />
                <span class="td">
                    <span data-i18n="swim"></span> (25%)
                </span>
                <input type="number" name="attr_swim" min="25" value="25" />
                <button type="action" class="roll skill" name="act_swim" ></button>
            </div>
            <div class="trow" data-i18n-list-item="conceal">
                <input type="checkbox" name="attr_success-conceal" />
                <span class="td">
                    <span data-i18n="conceal"></span> (15%)
                </span>
                <input type="number" name="attr_conceal" min="15" value="15" />
                <button type="action" class="roll skill" name="act_conceal" ></button>
            </div>
            <div class="trow" data-i18n-list-item="hide">
                <input type="checkbox" name="attr_success-hide" />
                <span class="td">
                    <span data-i18n="hide"></span> (10%)
                </span>
                <input type="number" name="attr_hide" min="10" value="10" />
                <button type="action" class="roll skill" name="act_hide" ></button>
            </div>
            <div class="trow" data-i18n-list-item="navigate">
                <input type="checkbox" name="attr_success-navigate" />
                <span class="td">
                    <span data-i18n="navigate"></span> (10%)
                </span>
                <input type="number" name="attr_navigate" min="10" value="10" />
                <button type="action" class="roll skill" name="act_navigate" ></button>
            </div>
            <div style="margin: 2% 5%;">
                <span></span>
                <span>
                    <span data-i18n="other_language"></span> (01%)
                </span>
                <span></span>
                <span></span>
            </div>
            <fieldset class="repeating_otherlanguage">
                <div class="trow">
                    <input type="checkbox" name="attr_success" />
                    <div style="width: 100%;">
                        <input type="text" style="width: 80%;" name="attr_skillname"></input>
                    </div>                    
                    <input type="number" name="attr_score" value="1" />
                    <button type="action" class="roll skill" name="act_score"></button>
                </div>
            </fieldset>
            <div class="trow" data-i18n-list-item="persuade">
                <input type="checkbox" name="attr_success-persuade" />
                <span class="td">
                    <span data-i18n="persuade"></span> (10%)
                </span>
                <input type="number" name="attr_persuade" min="15" value="15" />
                <button type="action" class="roll skill" name="act_persuade" ></button>
            </div>
            <div class="trow" data-i18n-list-item="pilot">
                <input type="checkbox" name="attr_success-pilot" />
                <span class="td">
                    <span data-i18n="pilot"></span> (01%)
                </span>
                <input type="number" name="attr_pilot" min="1" value="1" />
                <button type="action" class="roll skill" name="act_pilot"></button>
            </div>
            <div class="trow" data-i18n-list-item="first-aid">
                <input type="checkbox" name="attr_success-first-aid" />
                <span class="td">
                    <span data-i18n="first-aid"></span> (30%)
                </span>
                <input type="number" name="attr_first-aid" min="30" value="30" />
                <button type="action" class="roll skill" name="act_first-aid"></button>
            </div>
            <div class="trow" data-i18n-list-item="psychoanalisis">
                <input type="checkbox" name="attr_success-psychoanalisis" />
                <span class="td">
                    <span data-i18n="psychoanalisis"></span> (01%)
                </span>
                <input type="number" name="attr_psychoanalisis" min="1" value="1" />
                <button type="action" class="roll skill" name="act_psychoanalisis"></button>
            </div>
            <div class="trow" data-i18n-list-item="psychology">
                <input type="checkbox" name="attr_success-psychology" />
                <span class="td">
                    <span data-i18n="psychology"></span> (05%)
                </span>
                <input type="number" name="attr_psychology" min="5" value="5" />
                <button type="action" class="roll skill" name="act_psychology"></button>
            </div>
            <div class="trow" data-i18n-list-item="chemistry">
                <input type="checkbox" name="attr_success-chemistry" />
                <span class="td">
                    <span data-i18n="chemistry"></span> (01%)
                </span>
                <input type="number" name="attr_chemistry" min="1" value="1" />
                <button type="action" class="roll skill" name="act_chemistry"></button>
            </div>
            <div class="trow" data-i18n-list-item="bargain">
                <input type="checkbox" name="attr_success-bargain" />
                <span class="td">
                    <span data-i18n="bargain"></span> (05%)
                </span>
                <input type="number" name="attr_bargain" min="5" value="5" />
                <button type="action" class="roll skill" name="act_bargain"></button>
            </div>
            <div class="trow" data-i18n-list-item="jump">
                <input type="checkbox" name="attr_success-jump" />
                <span class="td">
                    <span data-i18n="jump"></span> (25%)
                </span>
                <input type="number" name="attr_jump" min="25" value="25" />
                <button type="action" class="roll skill" name="act_jump"></button>
            </div>
            <div class="trow" data-i18n-list-item="track">
                <input type="checkbox" name="attr_success-track" />
                <span class="td">
                    <span data-i18n="track"></span> (10%)
                </span>
                <input type="number" name="attr_track" min="10" value="10" />
                <button type="action" class="roll skill" name="act_track"></button>
            </div>
            <div class="trow" data-i18n-list-item="climb">
                <input type="checkbox" name="attr_success-climb" />
                <span class="td">
                    <span data-i18n="climb"></span> (40%)
                </span>
                <input type="number" name="attr_climb" min="40" value="40" />
                <button type="action" class="roll skill" name="act_climb"></button>
            </div>
        </div>
        <div class="col">
            <div style="margin: 2% 5%;">
                <span></span>
                <span>
                    <b data-i18n="firearms"></b>
                </span>
                <span></span>
                <span></span>
            </div>
            <div class="trow" data-i18n-list-item="machine-gun">
                <input type="checkbox" name="attr_success-machine-gun" />
                <span class="td">
                    <span data-i18n="machine-gun"></span> (15%)
                </span>
                <input type="number" name="attr_machine-gun" min="15" value="15" />
            </div>
            <div class="trow" data-i18n-list-item="handgun">
                <input type="checkbox" name="attr_success-handgun" />
                <span class="td">
                    <span data-i18n="handgun"></span> (20%)
                </span>
                <input type="number" name="attr_handgun" min="20" value="20" />
            </div>
            <div class="trow" data-i18n-list-item="rifle">
                <input type="checkbox" name="attr_success-rifle" />
                <span class="td">
                    <span data-i18n="rifle"></span> (25%)
                </span>
                <input type="number" name="attr_rifle" min="25" value="25" />
            </div>
            <div class="trow" data-i18n-list-item="shotgun">
                <input type="checkbox" name="attr_success-shotgun" />
                <span class="td">
                    <span data-i18n="shotgun"></span> (30%)
                </span>
                <input type="number" name="attr_shotgun" min="30" value="30" />
            </div>
            <div class="trow" data-i18n-list-item="submachine-gun">
                <input type="checkbox" name="attr_success-submachine-gun" />
                <span class="td">
                    <span data-i18n="submachine-gun"></span> (15%)
                </span>
                <input type="number" name="attr_submachine-gun" min="15" value="15" />
            </div>
        </div>
    </div>
    
</div>
<div id="combat" class="tabcontent">
    <div class="trow">
        <div class="trow">
            <span>Iniciativa</span>
            <input type="number" name="attr_DES" class="readonly" />
        </div>
        <div class="trow">
            <span data-i18n="dmg-bonus-u"></span>
            <input type="text" class="readonly" name="attr_dmg-bonus" style="width: 3.5em;" />
        </div>
    </div>
</div>
<div id="items" class="tabcontent">
    <h2 class="title">Equipo y armas</h2>
    <br>
    <h3 class="title" data-i18n="weapons"></h3>
    <br>
    <h4 class="title" data-i18n="melee-weapons"></h4>
    <div>
        <div class="table-melee">
            <div class="trow">
                <span></span>
                <span data-i18n="attack-or-weapon-u"></span>
                <span>%</span>
                <span data-i18n="damage-u"></span>
                <span data-i18n="hands"></span>
                <span data-i18n="round-u"></span>
                <span data-i18n="hit-points-u"></span>
                <span data-i18n="roll-u"></span>
            </div>
            <div class="trow">
                <input type="checkbox" name="attr_success-fist" />
                <span data-i18n="fist"></span>
                <input type="number" name="attr_fist" value="50" min="50" />
                <input type="text" class="dmg" value="1d4" name="attr_fist-damage">
                <span>1</span>
                <span>1</span>
                <span>n/a</span>
                <button type="action" class="roll skill" name="act_fist"></button>
            </div>
            <div class="trow">
                <input type="checkbox" name="attr_success-head-butt" />
                <span data-i18n="head-butt"></span>
                <input type="number" name="attr_head-butt" value="10" min="10" />
                <input type="text" class="dmg" value="1d4" name="attr_head-butt-damage">
                <span>0</span>
                <span>1</span>
                <span>n/a</span>
                <button type="action" class="roll skill" name="act_head-butt"></button>
            </div>
            <div class="trow">
                <input type="checkbox" name="attr_success-kick" />
                <span data-i18n="kick"></span>
                <input type="number" name="attr_kick" value="25" min="25" />
                <input type="text" class="dmg" value="1d6" name="attr_kick-damage">
                <span>0</span>
                <span>0</span>
                <span>n/a</span>
                <button type="action" class="roll skill" name="act_kick"></button>
            </div>
            <div class="trow">
                <input type="checkbox" name="attr_success-grapple" />
                <span data-i18n="grapple"></span>
                <input type="number" name="attr_grapple" value="25" min="25" />
                <input type="text" class="dmg" value="0" name="attr_grapple-damage">
                <span>0</span>
                <span>2</span>
                <span>n/a</span>
                <button type="action" class="roll skill" name="act_grapple"></button>
            </div>
            <fieldset class="repeating_melee">
                <div class="trow">
                    <input type="checkbox" name="attr_success" />
                    <input style="width: 80%;" type="text" name="attr_skillname" />
                    <input type="number" name="attr_score" value="0" />
                    <input type="text" class="dmg" name="attr_damage" />
                    <input type="number" name="attr_hands" />
                    <input type="number" name="attr_attack-rounds" />
                    <input type="text" class="dmg" name="attr_hp" />
                    <button type="action" class="roll skill" name="act_score" ></button>
                </div>
            </fieldset>
        </div>
        <div>
                        
        </div>
    </div>
    <hr>
    <h4 class="title" data-i18n="firearms"></h4>
    <div>
        <div class="trow">
            <span></span>
            <span data-i18n="weapon-name"></span>
            <span data-i18n="weapon-u"></span>
            <span data-i18n="damage-u"></span>
            <span data-i18n="base-range-u"></span>
            <span data-i18n="shots-u"></span>
            <span data-i18n="total-shots-u"></span>
        </div>
        <fieldset class="repeating_firearms">
            <div class="trow">
                <input type="checkbox" name="attr_success" />
                <input style="width: 80%;" type="text" name="attr_skillname" />
                <select name="attr_weapon-skill">
                    <option value="machine-gun" data-i18n="machine-gun"></option>
                    <option value="handgun" data-i18n="handgun"></option>
                    <option value="rifle" data-i18n="rifle"></option>
                    <option value="shotgun" data-i18n="shotgun"></option>
                    <option value="submachine-gun" data-i18n="submachine-gun"></option>
                </select>
                <input type="text" class="dmg" name="attr_damage" />
                <input type="number" name="attr_range" />
            </div>
        </fieldset>
    </div>
    <div>
    </div>
</div>
<div class="rolltemplates" >
    <rolltemplate class="sheet-rolltemplate-skills">
        <div class="table-u">
            <div class="trow" >
                <span>{{character_name}}</span>
            </div>
            <div class="trow" >
                <h3>{{name}}</h3>
            </div>

            <div class="trow roll_wrapper">
                <div class="roll__failure">
                    <span data-i18n="failure"></span>
                </div>
                <div class="roll__success">
                    <span data-i18n="success"></span>
                </div>
                <div class="roll__result">
                    <span>{{roll}}</span>
                    <span> vs </span>
                    <span>{{value}}</span>
                </div>
            </div>
        </div>       
    </rolltemplate>
    <rolltemplate class="sheet-rolltemplate-dice">
        <table>
            <caption>{{name}}</caption>
            <tbody>
                {{#allprops() name computed roll}}
                    <tr>
                        <td>{{key}}</td>
                        <td>{{value}}</td>
                    </tr>
                {{/allprops() name computed roll}}
                {{#roll}}
                <tr>
                    <td data-i18n="roll-u"></td>
                    <td >{{roll}}</td>
                </tr>
                {{/roll}}
                <tr>
                    <td>Resultado</td>
                    <td>{{computed::roll}}</td>
                </tr>
            </tbody>        
        </table>    
    </rolltemplate>
    <rolltemplate class="sheet-rolltemplate-attk">
        <table>
            <caption>{{name}}</caption>
            <tbody>
                <tr>
                    <td>{{atk_name}}</td>
                    <td>{{atk_value}}</td>
                </tr>
                {{#roll}}
                <tr>
                    <td data-i18n="attack-u"></td>
                    <td >{{roll}}</td>
                </tr>
                {{/roll}}
                <tr>
                    <td>Resultado</td>
                    <td>{{computed::roll}}</td>
                </tr>
                {{#rollLess() roll @atk_value}}
                <tr>
                    <td data-i18n="attack-u"></td>
                    <td >1</td>
                </tr>
                {{/rollLess() roll @atk_value}}
                <tr>
                    <td colspan="2">[Da√±o](`!&#13; [[{{dmg}} + {{dmg-bonus}} + ?{Bonus|0|1|2|3|4|5}]])</td>
                </tr>
            </tbody>
        </table>
    </rolltemplate>
</div>
<script type="text/worker">
    var DAMAGE_BONUS = {
        table: [
            {bonus: '-1d6', range: _.range( 0,  11)},
            {bonus: '-1d4', range: _.range( 11, 15)},
            {bonus:    '0', range: _.range( 15, 23)},
            {bonus:  '1d4', range: _.range( 23, 31)},
            {bonus:  '1d6', range: _.range( 31, 39)},
            {bonus:  '2d6', range: _.range( 39, 55)},
            {bonus:  '3d6', range: _.range( 55, 71)},
            {bonus:  '4d6', range: _.range( 71, 87)},
            {bonus:  '5d6', range: _.range( 87,104)},
            {bonus:  '6d6', range: _.range(104,119)},
            {bonus:  '7d6', range: _.range(119,135)},
            {bonus:  '8d6', range: _.range(135,151)},
            {bonus:  '9d6', range: _.range(151,167)},
            {bonus: '10d6', range: _.range(167,183)},
            {bonus: '11d6', range: _.range(183,199)},
            {bonus: '12d6', range: _.range(199,215)},
            {bonus: '13d6', range: _.range(215,231)},
            {bonus: '14d6', range: _.range(231,247)},
            {bonus: '15d6', range: _.range(247,263)},
        ],
        getBonusForValue : function(value) {
            var tableEntry = _.filter(this.table, function(item){
                return item.range.indexOf(parseInt(value||0)) !== -1
            })[0]
            return tableEntry.bonus;
        }
    }

    var attributes = {
        "FUE": 3,
        "CON": 3,
        "TAM": 8,
        "DES": 3,
        "APA": 3,
        "INT": 8,
        "POD": 3,
        "EDU": 6
    }

    on("clicked:reset-character", function(eventinfo){
        setAttrs(attributes)
    })

    
    
    var changes = ["FUE", "CON", "TAM", "DES", "APA", "INT", "POD", "EDU","cthulhumythos"]
    var change_string = _.map(changes, function(value){
        return "change:" + value
    }).join(" ")

    on("sheet:opened", function(eventinfo){
        getAttrs(["sheetTab"], function(values){
            var element = values.sheetTab
            updateTabs(element)
        })
        
        initAttributes()
        $20('input.navbar').on('change', function(eventinfo){
            var element = eventinfo.htmlAttributes.value
            updateTabs(element)
        })
        $20('button.tab').on('click', function(eventinfo){
            var element = eventinfo.htmlAttributes.name.replace("act_","")
            setAttrs({
                sheetTab: element
            })
            updateTabs(element)
            
        })
        
        $20('button.attr').on('click', function(eventinfo){
            var htmlAttributes = eventinfo.htmlAttributes
            var attribute = htmlAttributes.name
            var operation = htmlAttributes.class.split(" ")[1] == "up"? 1:-1

            getAttrs([attribute], function(values){
                var value = parseInt(values[attribute])
                var obj = {}
                obj[attribute] = value + operation

                setAttrs(obj)
            })
        })

        $20('button.secondary').on('click', function(eventinfo){
            var name = eventinfo.htmlAttributes.name.replace("act_", "")
            getAttrs([name], function(values){
                console.log(name)
                var value = parseInt(values[name])
                console.log(value)
                let rollBase = '&{template:skills} {{character_name=@{character_name}}} {{name=$0}} {{value=$1}} {{roll=[[1d100]]}}'
                console.log(rollBase)
                rollBase = rollBase.replace("$0", name).replace("$1", value)
                startRoll(rollBase, function(results){
                    finishRoll(results.rollId)
                })
            })
        })
    })
    
    on(change_string, function(eventinfo){
        initAttributes()
    })
    
    on("change:HP", function(eventinfo){
        getAttrs(["CON", "TAM"], (values) => {
    
            var hp = eventinfo["newValue"]
            var value = Math.ceil((parseInt(values.CON) + parseInt(values.TAM))/2)
            if(hp > value){
                setAttrs({
                    "HP": value
                })
            }
        })
        
    })

    on("change:MP", function(eventinfo){

        getAttrs(["POD"], function(values){
            var mp = eventinfo["newValue"]
            var value = parseInt(values.POD)
            if(mp > value){
                setAttrs({
                    "MP": value
                })
            }
        })
    })
    
    var attrs = ["FUE", "DES", "INT", "CON", "APA", "POD", "TAM", "EDU"]
    
    attrs.forEach(attr => {
        on(`clicked:${attr}`, function(eventinfo){
            var name = getTranslationByKey(attr)
            getAttrs([attr, "character_name"], function(values){
                var character_name = values.character_name
                var value = parseInt(values[attr])
                let rollBase = '&{template:dice} {{name=@{character_name}}} {{Atributo=$0}} {{Valor=$1}} {{roll=[[1d100]]}}'
                console.log(rollBase)
                rollBase = rollBase.replace("$0", name).replace("$1", value)
                startRoll(rollBase, function(results){
                    finishRoll(results.rollId)
                })
            })
        })
    })
    
    var skill_list = getTranslationByKey("skills-list").split(",")
    skill_list.forEach(skill => {
        
        on(`clicked:${skill}`, function(eventinfo){
            getAttrs([skill], function(values){
                var value = parseInt(values[skill])
                var skill_name = getTranslationByKey(skill)
                console.log(skill_name)
                rollSkill(skill_name, value)
                
            })
        })
    })

    var repeatings = ["art", "martial", "otherlanguage"]

    
    
    repeatings.forEach(item => {

        on(`clicked:repeating_${item}`, function(info){
            var sourceAttribute = info.sourceAttribute
            getAttrs([`${sourceAttribute}_skillname`, `${sourceAttribute}_score`], function(values){
                var value = parseInt(values[`${sourceAttribute}_score`])
                var skill = values[`${sourceAttribute}_skillname`]
                rollSkill(skill, value)
            })
        })
    })

    
    var attacks = ["fist", "head-butt", "kick", "grapple"]
    attacks.forEach( item => {        
        on(`clicked:${item}`, function(eventinfo){
            var dmg_name = `${item}-damage`
            getAttrs([item, dmg_name, "dmg-bonus", "character_name"], function(values){
                var character_name = values.character_name
                var atk_value = parseInt(values[item])
                var bonus = values["dmg-bonus"]
                var dmg = values[dmg_name]
                var name = getTranslationByKey(item)
                var obj = {
                    "name": "@{character_name}",
                    "dmg": dmg,
                    "atk_name": name,
                    "atk_value": atk_value,
                    "dmg-bonus": bonus,
                    "roll": "[[1d100]]"
                }
                var query_string = Object.entries(obj).map(function([key, value]){
                    return `{{${key}=${value}}}`
                }).join(" ")
                let rollBase = `&{template:attk} ${query_string}`
                startRoll(rollBase, function(results){
                    const total = results.results.roll.result
                    const success = total <= atk_value?1:0
                    finishRoll(
                        results.rollId,
                        {
                            roll: success
                        }
                    );
                })
            })
        })
    })
    var secon_attrs = ["idea", "luck", "know"]
    
    secon_attrs.forEach(item => {
        on(`clicked:${item}`, function(eventinfo){
            getAttrs([item], function(values){
                var value = parseInt(values[item])
                startRoll(`/roll 1d100<${value}`, function(results){
                    finishRoll(results.rollId)
                })
            })
        })
    })
    
    on("clicked:Init", function(eventinfo){
        getAttrs(["DES"], function(values){
            var value = parseInt(values.DES)
            var rollBase = "&{template:dice} {{name=@{character_name}}} {{Iniciativa=[[$value &{tracker}]]}}"
            rollBase = rollBase.replace("$value", value)
            console.log(rollBase)
            startRoll(rollBase, function(results){
                finishRoll(results.rollId)
            })
        })
    })

    function updateTabs(element){
        $20('.tabcontent').removeClass("show-tabcontent")
        var name = `#${element}`
        var selector = $20(name)
        selector.addClass("show-tabcontent")
        
    }    

    function initAttributes(){

        
        getAttrs(["INT"], function(values) {
            var val=parseInt(values.INT)
            setAttrs({
                "idea":val*5,
                "Hab-PJ": val*10,
                INT: val
            })
        });

        getAttrs(["CON", "TAM", "HP"], function(values){
            var valCon=parseInt(values.CON);
            var valSiz=parseInt(values.TAM);
            var val=valCon+valSiz;
            var hp = values.HP == undefined?Math.round(val/2):parseInt(values.HP)
            setAttrs({
                "stableHP": Math.round(val/2),
                "CON": valCon,
                "TAM": valSiz,
                "HP": hp
            })
    
        });
    
        getAttrs(["POD", "Sanity", "MP"], function(values) {
            var val=parseInt(values.POD)
            var sanity = values["Sanity"] == ""? val*5:parseInt(values["Sanity"])
            var mp = values.MP == undefined?val:parseInt(values.MP)
            if(mp > val){
                mp = val
            }
            
            var obj = {
                "luck": val*5,
                "stableMP": val,
                "COR": val*5,
                "POD": val,
                "Sanity": sanity,
                "MP": mp,
                "stableSanity": val*5
            }
            setAttrs(obj)
        });
    
        getAttrs(["EDU"], function(values) {
            var value=parseInt(values.EDU)            
    
            setAttrs({
                "know":value*5,
                "Hab-Ocu":value*20,
                "EDU": value
            })
        });    
        
    
        getAttrs(["FUE", "TAM"], function(values){
            var value = parseInt(values.FUE) + parseInt(values.TAM) -2
            var damage_bonus = DAMAGE_BONUS.getBonusForValue(value);
            setAttrs({
                "dmg-bonus": damage_bonus
            })
    
        });
    
        getAttrs(["cthulhumythos"], function(values){
            var value = values.cthulhumythos
    
            val = value == null?0:parseInt(value)
            setAttrs({
                "Max-Sanity":99-val
            })
    
        });
    }
    
    
    function rollSkill(skill, value){
        let rollBase = '&{template:dice} {{name=@{character_name}}} {{Habilidad=$0}} {{Valor=$1}} {{roll=[[1d100]]}} {{computed=1}}'
        rollBase = rollBase.replace("$0", skill)
        rollBase = rollBase.replace("$1", value)
        startRoll(rollBase, function(results){
            const total = results.results.roll.result
            const computed = total/value
            var success = computed <= 1?1:0
            finishRoll(
                results.rollId,
                {
                    roll: success
                }
            );
        })
    }

    function updateSkills(name){
        var skill = name.replace("success-", "attr_")
        getAttrs([name], function(values){
            var checked = values[name] !== "0"
            var input_element = $20(`input[name="${skill}"]`)
            if(checked){
                input_element.removeClass('readonly')
                input_element.addClass('show')
            }else{
                input_element.addClass('readonly')
                input_element.removeClass('show')
            }
        })
    }
    
    
    

</script>
<script type="text/javascript" src="index.js"></script>
</body>